import React, { useState, useEffect, useRef } from "react";
import { FaBook, FaPlus, FaVideo, FaFileAlt, FaEdit, FaTrash, FaTimes, FaSave} from "react-icons/fa";
import { useNavigate, useLocation } from "react-router-dom";
import { jwtDecode } from "jwt-decode";
import TeacherCoursesLayout from "../../Layout";
import { getToken } from "../../../../../auth/authHelper";

function TeacherAddCourses() {
  const navigate = useNavigate();
  const location = useLocation();
  const hasCheckedPermissionRef = useRef(false);
  const [exercises, setExercises] = useState([]);
  const [editingQuestionIndex, setEditingQuestionIndex] = useState(null);
  const [exerciseFormData, setExerciseFormData] = useState({
    question: '',
    answers: {
      A: '',
      B: '',
      C: '',
      D: ''
    },
    correctAnswer: ''
  });
  const handleCancelEdit = () => {
    setEditingQuestionIndex(null); // ƒê·∫∑t l·∫°i tr·∫°ng th√°i ch·ªâ s·ªë c√¢u h·ªèi
    setExerciseFormData({
      question: '',
      answers: {
        A: '',
        B: '',
        C: '',
        D: ''
      },
      correctAnswer: ''
    }); // X√≥a d·ªØ li·ªáu trong form
  };
  
  const [isEditing, setIsEditing] = useState(false);
  const [isAddingNewExercise, setIsAddingNewExercise] = useState(false); // Tr·∫°ng th√°i ƒë·ªÉ ƒëi·ªÅu khi·ªÉn hi·ªÉn th·ªã form
  const handleEdit = (index) => {
    setIsEditing(true);
    setEditingQuestionIndex(index);
    
    // L·∫•y c√¢u h·ªèi c·∫ßn ch·ªânh s·ª≠a
    const exerciseToEdit = exercises[index];
  
    // C·∫≠p nh·∫≠t form v·ªõi d·ªØ li·ªáu c·ªßa c√¢u h·ªèi ƒëang ƒë∆∞·ª£c s·ª≠a
    setExerciseFormData({
      question: exerciseToEdit.question,
      answers: {
        A: exerciseToEdit.answers.A,
        B: exerciseToEdit.answers.B,
        C: exerciseToEdit.answers.C,
        D: exerciseToEdit.answers.D
      },
      correctAnswer: exerciseToEdit.correctAnswer // G√°n ƒë√°p √°n ƒë√∫ng
    });
  };
  
  const handleSaveEdit = () => {
    // C·∫≠p nh·∫≠t l·∫°i c√¢u h·ªèi trong exercises sau khi s·ª≠a
    const updatedExercises = [...exercises];
    updatedExercises[editingQuestionIndex] = exerciseFormData;
  
    setExercises(updatedExercises); // L∆∞u l·∫°i danh s√°ch ƒë√£ s·ª≠a
    setIsEditing(false); // ƒê√≥ng ch·∫ø ƒë·ªô s·ª≠a
    setEditingQuestionIndex(null); // X√≥a ch·ªâ s·ªë c√¢u h·ªèi ƒëang s·ª≠a
    setExerciseFormData({
      question: '',
      answers: {
        A: '',
        B: '',
        C: '',
        D: ''
      },
      correctAnswer: ''
    }); // Reset d·ªØ li·ªáu form
  };
  const handleInputChange = (e) => {
    const { name, value } = e.target;

    if (["A", "B", "C", "D"].includes(name)) {
      setExerciseFormData((prev) => ({
        ...prev,
        answers: { ...prev.answers, [name]: value },
      }));
    } else {
      setExerciseFormData((prev) => ({ ...prev, [name]: value }));
    }
  };

  const handleSelectCorrectAnswer = (opt) => {
    // C·∫≠p nh·∫≠t l·∫°i ƒë√°p √°n ƒë√∫ng khi ng∆∞·ªùi d√πng ch·ªçn
  setExerciseFormData({
    ...exerciseFormData,
    correctAnswer: opt // C·∫≠p nh·∫≠t ƒë√°p √°n ƒë√∫ng
  });
  };

  const handleAddExercise = () => {
    setExercises((prev) => [...prev, exerciseFormData]);
    setExerciseFormData({
      question: "",
      answers: { A: "", B: "", C: "", D: "" },
      correctAnswer: "",
    });
    setIsAddingNewExercise(false); // ·∫®n form sau khi th√™m c√¢u h·ªèi
  };

  const handleDeleteExercise = (index) => {
    setExercises((prev) => prev.filter((_, i) => i !== index));
  };
  // H√†m ƒë·ªÉ h·ªßy vi·ªác th√™m c√¢u h·ªèi v√† x√≥a d·ªØ li·ªáu form
  const handleCancelAdd = () => {
    setExerciseFormData({
      question: "",
      answers: { A: "", B: "", C: "", D: "" },
      correctAnswer: "",
    });
    setIsAddingNewExercise(false); // ·∫®n form khi h·ªßy
  };
  const [formData, setFormData] = useState({
    title: "",
    description: "",
    tags: "",
    price: "",
    courseImage: null,
    introVideo: null,
    qr_code: null,
    courseLevel: "basic",
  });

  const [chapters, setChapters] = useState([]);

  useEffect(() => {
    const token = getToken();
    if (!token) {
      alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p! Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c.");
      navigate("/login");
    }
  }, [navigate]);

  useEffect(() => {
    const token = getToken();
    if (location.state?.course && token && !hasCheckedPermissionRef.current) {
      hasCheckedPermissionRef.current = true;
      const decoded = jwtDecode(token);
      const currentUserId = decoded.user_id || decoded.id || decoded.sub;
      const course = location.state.course;
      if (course.teacher_id && course.teacher_id !== currentUserId) {
        alert("B·∫°n kh√¥ng c√≥ quy·ªÅn ch·ªânh s·ª≠a kh√≥a h·ªçc n√†y!");
        navigate("/teachercourses/listcourses");
        return;
      }

      setFormData({
        title: course.title || "",
        description: course.intro || "",
        tags: course.tags || "", 
        price: course.fee || 0,
        courseImage: course.thumbnail || null,
        introVideo: course.intro_video || null,
        qr_code: course.qr_code || null, // üÜï Th√™m d√≤ng n√†y
      });
      setChapters(course.chapters || []);
    }
  }, [location.state, navigate]);

  const handleFormChange = (e) => {
    const { name, value, files } = e.target;
  
    if (name === "courseImage" || name === "introVideo" || name === "qr_code") {  // üõ†Ô∏è S·ª≠a ƒë√∫ng field
      setFormData({ ...formData, [name]: files[0] });
    } else if (name === "price") {
      const numericValue = Number(value);
      if (numericValue >= 0) {
        setFormData({ ...formData, [name]: numericValue });
      }
    } else {
      setFormData({ ...formData, [name]: value });
    }
  };

  const handlePriceChange = (e) => {
    const value = e.target.value;
    if (value >= 0) {
      setFormData((prevData) => ({
        ...prevData,
        price: value,
      }));
    }
  };

  const addChapter = () => {
    setChapters([...chapters, { title: "", lessons: [] }]);
  };

  const deleteChapter = (chapterIndex) => {
    const updated = chapters.filter((_, index) => index !== chapterIndex);
    setChapters(updated);
  };

  const handleChapterChange = (index, field, value) => {
    const updated = [...chapters];
    updated[index][field] = value;
    setChapters(updated);
  };

  const addLesson = (chapterIndex) => {
    const updated = [...chapters];
    updated[chapterIndex].lessons.push({
      title: "",
      video: null,
      document_link: null,
      exercise: null,
    });
    setChapters(updated);
  };

  const deleteLesson = (chapterIndex, lessonIndex) => {
    const updated = [...chapters];
    updated[chapterIndex].lessons = updated[chapterIndex].lessons.filter((_, index) => index !== lessonIndex);
    setChapters(updated);
  };

  const handleLessonChange = (chapterIndex, lessonIndex, field, value) => {
    const updated = [...chapters];
  
    // Ki·ªÉm tra n·∫øu ƒëang thay ƒë·ªïi m·ªôt tr∆∞·ªùng trong `exercise`
    if (field.startsWith("exercise")) {
      const parts = field.split("."); // e.g. ["exercise", "answers", "A"] or ["exercise", "question"]
      
      // N·∫øu ch∆∞a c√≥ exercise, kh·ªüi t·∫°o n√≥
      if (!updated[chapterIndex].lessons[lessonIndex].exercise) {
        updated[chapterIndex].lessons[lessonIndex].exercise = {
          question: "",
          answers: { A: "", B: "", C: "", D: "" },
          correctAnswer: "",
          score: 0,
        };
      }
  
      if (parts[1] === "answers") {
        const answerKey = parts[2]; // "A", "B", "C", "D"
        updated[chapterIndex].lessons[lessonIndex].exercise.answers[answerKey] = value;
        
        // C·∫≠p nh·∫≠t l·∫°i form state n·∫øu c√≥ form t·∫°m
        setExerciseFormData((prev) => ({
          ...prev,
          answers: {
            ...prev.answers,
            [answerKey]: value,
          },
        }));
      } else {
        const key = parts[1]; // "question", "correctAnswer", etc.
        updated[chapterIndex].lessons[lessonIndex].exercise[key] = value;
  
        setExerciseFormData((prev) => ({
          ...prev,
          [key]: value,
        }));
      }
    } else {
      // C·∫≠p nh·∫≠t c√°c tr∆∞·ªùng kh√°c ngo√†i exercise
      updated[chapterIndex].lessons[lessonIndex][field] = value;
    }
  
    setChapters(updated);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const token = getToken();
    if (!token) {
      alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!");
      navigate("/login");
      return;
    }
  
    const formDataToSend = new FormData();
    formDataToSend.append("title", formData.title);
    formDataToSend.append("description", formData.description);
    formDataToSend.append("tags", formData.tags);
    formDataToSend.append("price", formData.price);
    formDataToSend.append("courseLevel", formData.courseLevel);
  
    if (formData.courseImage) {
      formDataToSend.append("courseImage", formData.courseImage);
    }
    if (formData.introVideo) {
      formDataToSend.append("introVideo", formData.introVideo);
    }
    if (formData.qr_code) {
      formDataToSend.append("qr_code", formData.qr_code);
    }
  
    // T·∫°o chapters v·ªõi lessons ƒë√£ x·ª≠ l√Ω ƒë·∫ßy ƒë·ªß
    // T·∫°o chapters v·ªõi lessons ƒë√£ x·ª≠ l√Ω ƒë·∫ßy ƒë·ªß
const chaptersWithoutFiles = chapters.map((chapter, chapterIndex) => {
  const lessons = chapter.lessons.map((lesson, lessonIndex) => {
    // N·∫øu c√≥ exercise, x·ª≠ l√Ω v√† g·ª≠i, n·∫øu kh√¥ng c√≥ th√¨ kh√¥ng g·ª≠i.
    const exerciseData = lesson.exercise && Object.keys(lesson.exercise).length > 0
      ? {
          question: lesson.exercise.question || "",
          answers: {
            A: lesson.exercise.answers?.A || "",
            B: lesson.exercise.answers?.B || "",
            C: lesson.exercise.answers?.C || "",
            D: lesson.exercise.answers?.D || "",
          },
          correctAnswer: lesson.exercise.correctAnswer || "",
          score: lesson.exercise.score || 0,
        }
      : null;  // Kh√¥ng g·ª≠i exercise n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu

    return {
      title: lesson.title || "",
      video: lesson.video ? `lesson_video_${chapterIndex}_${lessonIndex}` : null,
      document_link: lesson.document_link ? `lesson_document_link_${chapterIndex}_${lessonIndex}` : null,
      exercise: exerciseData,  // G·ª≠i null n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu b√†i t·∫≠p
    };
  });

  return {
    title: chapter.title || "",
    lessons,
  };
});

  
    // G·ª≠i JSON ph·∫ßn kh√¥ng ph·∫£i file
    formDataToSend.append("chapters", JSON.stringify(chaptersWithoutFiles));
  
    // G·ª≠i file video/document t·ª´ng b√†i h·ªçc
    chapters.forEach((chapter, chapterIndex) => {
      chapter.lessons.forEach((lesson, lessonIndex) => {
        if (lesson.video) {
          formDataToSend.append(`lesson_video_${chapterIndex}_${lessonIndex}`, lesson.video);
        }
        if (lesson.document_link) {
          formDataToSend.append(`lesson_document_link_${chapterIndex}_${lessonIndex}`, lesson.document_link);
        }
      });
    });
  
    // In d·ªØ li·ªáu ƒë·ªÉ ki·ªÉm tra
    console.log("--- FORM DATA G·ª¨I L√äN SERVER ---");
    for (let pair of formDataToSend.entries()) {
      console.log(pair[0] + ':', pair[1]);
    }
    console.log("--- END FORM DATA ---");
  
    // Ph√¢n bi·ªát edit hay add
    const isEditing = !!location.state?.course;
    const method = isEditing ? "PUT" : "POST";
    const endpoint = isEditing
      ? `http://localhost:8000/api/teacher/teacher_courses/teacher_addcourses/${location.state.course.id}/`
      : "http://localhost:8000/api/teacher/teacher_courses/teacher_addcourses/";
  
    try {
      const response = await fetch(endpoint, {
        method,
        headers: {
          Authorization: `Bearer ${token}`,
        },
        body: formDataToSend,
        credentials: 'omit',
      });
  
      const result = await response.json();
  
      if (response.ok) {
        alert(isEditing ? "C·∫≠p nh·∫≠t kh√≥a h·ªçc th√†nh c√¥ng!" : "Th√™m kh√≥a h·ªçc m·ªõi th√†nh c√¥ng!");
        navigate("/teachercourses/listcourses");
      } else {
        console.error("L·ªói chi ti·∫øt:", result);
        alert(`L·ªói: ${result.detail || result.error || JSON.stringify(result)}`);
      }
    } catch (error) {
      console.error("L·ªói ngo·∫°i l·ªá:", error);
      alert("C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!");
    }
  };
  
  return (
    <TeacherCoursesLayout>
      <div style={styles.outerContainer}>
        <div style={styles.formContainer}>
          <h2 style={styles.title}>
            <FaBook size={24} color="#003366" /> {location.state?.course ? "CH·ªàNH S·ª¨A KH√ìA H·ªåC" : "TH√äM KH√ìA H·ªåC"}
          </h2>

          <form onSubmit={handleSubmit} style={styles.form}>
            <div style={styles.sectionContainer}>
              <div style={styles.leftSection}>
                <input
                  type="text"
                  name="title"
                  placeholder="Ti√™u ƒë·ªÅ kh√≥a h·ªçc"
                  required
                  value={formData.title}
                  onChange={handleFormChange}
                  style={styles.input}
                />
                <textarea
                  name="description"
                  placeholder="M√¥ t·∫£ kh√≥a h·ªçc"
                  required
                  value={formData.description}
                  onChange={handleFormChange}
                  style={styles.textarea}
                />
                <input
                  type="text"
                  name="tags"
                  placeholder="T·ª´ kh√≥a (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)"
                  value={formData.tags}
                  onChange={handleFormChange}
                  style={styles.input}
                />
                <input
                  type="number"
                  name="price"
                  placeholder="Gi√° kh√≥a h·ªçc (VND)"
                  value={formData.price}
                  onChange={handlePriceChange}
                  min="0"  // <-- C√°i n√†y t·ª± ch·∫∑n kh√¥ng cho nh·∫≠p s·ªë √¢m
                  style={styles.input}
                />

                {formData.price > 0 && (
                  <div style={styles.inputGroup}>
                    <label htmlFor="qr_code" style={{ fontWeight: "bold", color: "#003366" }}>
                      ·∫¢nh QR thanh to√°n:
                    </label>
                    <input
                      type="file"
                      name="qr_code"        // <--- ƒë·ªïi t·ª´ "qrImage" th√†nh "qr_code"
                      id="qr_code"
                      accept="image/*"
                      onChange={handleFormChange}
                      style={styles.input}
                    />
                  </div>
                )}

              </div>

              <div style={styles.rightSection}>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>·∫¢nh gi·ªõi thi·ªáu: &nbsp; </label>
                  <input
                    type="file"
                    name="courseImage"
                    accept="image/*"
                    onChange={handleFormChange}
                    style={styles.input2}
                  />
                </div>
                
                <div style={styles.inputGroup}>
                <label style={styles.label}>Video gi·ªõi thi·ªáu:</label>
                  <input
                    type="file"
                    name="introVideo"
                    accept="video/*"
                    onChange={handleFormChange}
                    style={styles.input2}
                  />
                </div>

                <div style={styles.inputGroup}>
                  <label style={styles.label}>T·ªïng s·ªë b√†i h·ªçc:</label>
                  <input
                    type="text"
                    name="totalLessons"
                    onChange={handleFormChange}
                    style={styles.input2}
                  />
                </div>

                <div style={styles.inputGroup}>
                  <label style={styles.label}>Th·ªùi l∆∞·ª£ng: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                  <input
                    type="text"
                    name="courseDuration"
                    onChange={handleFormChange}
                    style={styles.input2}
                  />
                </div>

                <div style={styles.inputGroup}>
                  <label style={styles.label}>Tr√¨nh ƒë·ªô: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</label>
                  <select
                    name="courseLevel"
                    onChange={handleFormChange}
                    style={{ 
                      color: "#003366",  // ch·ªânh m√†u ch·ªØ c·ªßa option
                      padding: "10px",
                      border: "1px solid #ccc",
                      borderRadius: "5px",
                    }}
                  >
                    <option value="basic">C∆° b·∫£n</option>
                    <option value="medium">Trung b√¨nh</option>
                    <option value="hard">N√¢ng cao</option>
                  </select>

                </div>
              </div>

            </div>

            <hr style={{ margin: "20px 0" }} />

            <div>
              <h3 style={styles.stepTitle}>Ch∆∞∆°ng tr√¨nh gi·∫£ng d·∫°y</h3>
              {chapters.map((chapter, chapterIndex) => (
                <div key={chapterIndex} style={styles.chapter}>
                  <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
                    <input
                      type="text"
                      placeholder="Ti√™u ƒë·ªÅ ch∆∞∆°ng"
                      value={chapter.title}
                      onChange={(e) => handleChapterChange(chapterIndex, "title", e.target.value)}
                      style={styles.input}
                    />
                    <FaEdit style={{ cursor: "pointer", color: "#003366"}} />
                    <FaTrash style={{ cursor: "pointer", color: "#003366" }} onClick={() => deleteChapter(chapterIndex)} />
                  </div>

                  {chapter.lessons.map((lesson, lessonIndex) => (
                    <div key={lessonIndex} style={styles.lesson}>
                      <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
                        <input
                          type="text"
                          placeholder="Ti√™u ƒë·ªÅ b√†i h·ªçc"
                          value={lesson.title}
                          onChange={(e) => handleLessonChange(chapterIndex, lessonIndex, "title", e.target.value)}
                          style={styles.input}
                        />
                        <FaEdit style={{ cursor: "pointer", color: "#003366" }} />
                        <FaTrash
                          style={{ cursor: "pointer", color: "#003366" }}
                          onClick={() => deleteLesson(chapterIndex, lessonIndex)}
                        />
                      </div>

                      <div style={styles.lessonButtonGroup}>
                      <label><FaVideo /> Video b√†i gi·∫£ng:</label>
                      <input
                        type="file"
                        accept="video/*"
                        onChange={(e) => handleLessonChange(chapterIndex, lessonIndex, "video", e.target.files[0])}
                        style={styles.input3}
                      />
                      <label><FaFileAlt /> T√†i li·ªáu b√†i h·ªçc:</label>
                      <input
                        type="file"
                        accept=".pdf,.doc,.docx"
                        onChange={(e) => handleLessonChange(chapterIndex, lessonIndex, "document_link", e.target.files[0])}
                        style={styles.input3}
                      />
                      
                      {/* Hi·ªÉn th·ªã danh s√°ch c√¢u h·ªèi ƒë√£ nh·∫≠p */}
                      {exercises.map((ex, index) => (
                        <div key={index} style={{ border: "1px solid #ccc", borderRadius: 8, padding: 15, marginBottom: 20, backgroundColor: "#f9f9f9" }}>
                          <h4>C√¢u {index + 1}</h4>
                          <p><strong>ƒê·ªÅ b√†i:</strong> {ex.question}</p>
                          {["A", "B", "C", "D"].map((opt) => (
                            <p key={opt}>
                              <strong>ƒê√°p √°n {opt}:</strong> {ex.answers[opt]}{" "}
                              {ex.correctAnswer === opt && <span style={{ color: "green" }}>‚úì ƒê√°p √°n ƒë√∫ng</span>}
                            </p>
                          ))}
                          <div>
                            <button
                              type="button"
                              onClick={() => handleEdit(index)} // Chuy·ªÉn sang ch·∫ø ƒë·ªô s·ª≠a
                              style={{ ...styles.addButton, marginRight: 10 }}
                            >
                              <FaEdit /> S·ª≠a
                            </button>
                            <button
                              type="button"
                              onClick={() => handleDeleteExercise(index)} // X√≥a c√¢u h·ªèi
                              style={{ ...styles.addButton, backgroundColor: "#dc3545" }} // M√†u ƒë·ªè cho n√∫t X√≥a
                            >
                              <FaTrash /> X√≥a
                            </button>
                          </div>
                        </div>
                      ))}

                      {/* N√∫t Th√™m b√†i t·∫≠p */}
                      <button
                        type="button"
                        onClick={() => setIsAddingNewExercise(true)}
                        style={styles.addButton}
                      >
                        <FaPlus /> Th√™m b√†i t·∫≠p
                      </button>

                      {/* Form th√™m c√¢u h·ªèi m·ªõi */}
                      {isAddingNewExercise && (
                        <div
                          style={{
                            border: "1px solid #aaa",
                            borderRadius: 8,
                            padding: 15,
                            backgroundColor: "#eef",
                            color: "#003366",
                          }}
                        >
                          <h4>C√¢u {exercises.length + 1}</h4>

                          {/* Nh·∫≠p ƒë·ªÅ b√†i */}
                          <div>
                            <textarea
                              value={exerciseFormData.question}
                              onChange={(e) =>
                                handleLessonChange(chapterIndex, lessonIndex, "exercise.question", e.target.value)
                              }
                              rows={3}
                              placeholder="Nh·∫≠p ƒë·ªÅ b√†i"
                              style={styles.input5}
                            />
                          </div>

                          {/* Nh·∫≠p ƒë√°p √°n A, B, C, D */}
                          {["A", "B", "C", "D"].map((opt) => (
                            <div key={opt} style={{ marginBottom: 10, color: "#003366" }}>
                              <label>
                                ƒê√°p √°n {opt}:{" "}
                                <input
                                  type="text"
                                  value={exerciseFormData.answers[opt]}
                                  onChange={(e) =>
                                    handleLessonChange(chapterIndex, lessonIndex, `exercise.answers.${opt}`, e.target.value)
                                  }
                                  style={{ ...styles.input4, marginTop: 5 }}
                                />
                              </label>
                              <label style={{ marginLeft: 20 }}>
                                <input
                                  type="checkbox"
                                  checked={exerciseFormData.correctAnswer === opt}
                                  onChange={() =>
                                    handleLessonChange(chapterIndex, lessonIndex, "exercise.correctAnswer", opt)
                                  }
                                />
                                ƒê√°p √°n ƒë√∫ng
                              </label>
                            </div>
                          ))}

                          {/* N√∫t th√™m ho·∫∑c h·ªßy */}
                          <div style={{ marginTop: 15, display: "flex", gap: 10 }}>
                            <button style={styles.addButton} onClick={handleAddExercise}>
                              <FaPlus /> Th√™m c√¢u h·ªèi
                            </button>
                            <button
                              onClick={handleCancelAdd}
                              style={{ ...styles.addButton, backgroundColor: "#dc3545" }}
                            >
                              <FaTimes /> H·ªßy
                            </button>
                          </div>
                        </div>
                      )}


                      {/* Form s·ª≠a c√¢u h·ªèi n·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô s·ª≠a */}
                      {isEditing && (
                        <div style={{ border: "1px solid #aaa", borderRadius: 8, padding: 15, backgroundColor: "#eef", color: "#003366" }}>
                          <h4>S·ª≠a C√¢u {editingQuestionIndex + 1}</h4>
                          <div>
                            <textarea
                              name="question"
                              value={exerciseFormData.question}
                              onChange={handleInputChange}
                              rows={3}
                              placeholder="Nh·∫≠p ƒë·ªÅ b√†i"
                              style={styles.input5}
                            />
                          </div>
                          {["A", "B", "C", "D"].map((opt) => (
                            <div key={opt} style={{ marginBottom: 10, color: "#003366" }}>
                              <label>
                                ƒê√°p √°n {opt}:{" "}
                                <input
                                  type="text"
                                  name={opt}
                                  value={exerciseFormData.answers[opt]}
                                  onChange={handleInputChange}
                                  style={{ ...styles.input4, marginTop: 5 }}
                                />
                              </label>
                              <label style={{ marginLeft: 20 }}>
                                <input
                                  type="checkbox"
                                  checked={exerciseFormData.correctAnswer === opt}
                                  onChange={() => handleSelectCorrectAnswer(opt)}
                                />
                                ƒê√°p √°n ƒë√∫ng
                              </label>
                            </div>
                          ))}
                          <div style={{ marginTop: 15, display: "flex", gap: 10 }}>
                            <button
                              style={styles.addButton}
                              onClick={handleSaveEdit} // L∆∞u thay ƒë·ªïi
                            >
                              <FaSave /> L∆∞u s·ª≠a
                            </button>
                            <button
                              onClick={handleCancelEdit} // H·ªßy s·ª≠a
                              style={{ ...styles.addButton, backgroundColor: "#dc3545" }}
                            >
                              <FaTimes /> H·ªßy
                            </button>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                  ))}
                  <button type="button" onClick={() => addLesson(chapterIndex)} style={styles.addButton}>
                    <FaPlus /> Th√™m B√†i h·ªçc
                  </button>
                </div>
              ))}

              <button type="button" onClick={addChapter} style={styles.addButton}>
                <FaPlus /> Th√™m Ch∆∞∆°ng
              </button>
            </div>

            <button type="submit" style={styles.button}>
              {location.state?.course ? "C·∫≠p nh·∫≠t Kh√≥a h·ªçc" : "Th√™m kh√≥a h·ªçc"}
            </button>
          </form>
        </div>
      </div>
    </TeacherCoursesLayout>
  );
}

const styles = {
  outerContainer: {
    display: "flex",
    justifyContent: "center",
    padding: "15px 0",
    marginLeft: "108px",
  },
  formContainer: {
    width: "1000px",
    padding: "40px",
    backgroundColor: "rgba(255, 255, 255, 0.9)",
    boxShadow: "0px 4px 10px rgba(0, 0, 0, 0.2)",
    borderRadius: "10px",
  },
  sectionContainer: {
    display: "flex",
    justifyContent: "space-between",
  },
  leftSection: {
    width: "48%",
  },
  rightSection: {
    width: "48%",
  },
  title: {
    fontSize: "24px",
    marginBottom: "20px",
    color: "#003366",
    textAlign: "center",
  },
  form: {
    display: "flex",
    flexDirection: "column",
  },
  input: {
    width: "100%",
    padding: "10px",
    marginBottom: "10px",
    borderRadius: "5px",
    border: "1px solid #ccc",
  },

  input2: {
    width: "auto",  // ƒê·ªÉ input kh√¥ng chi·∫øm h·∫øt chi·ªÅu r·ªông, thay v√¨ 100%
    padding: "10px",  // Gi·ªØ padding nh∆∞ c≈©
    marginBottom: "10px",  // Kho·∫£ng c√°ch d∆∞·ªõi m·ªói input (c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh n·∫øu c·∫ßn)
    borderRadius: "5px",  // Bo g√≥c cho input
    border: "1px solid #ccc",  // Vi·ªÅn input
    marginLeft: "10px",  // Kho·∫£ng c√°ch gi·ªØa label v√† input (cho line-horizontal)
  },
  input3: {
    width: "97.5%",
    padding: "10px",
    marginBottom: "10px",
    borderRadius: "5px",
    border: "1px solid #ccc",
  },
  input4: {
    width: "50%",
    padding: "10px",
    marginBottom: "10px",
    borderRadius: "5px",
    border: "1px solid #ccc",
  },
  input5: {
    width: "97.5%",
    padding: "10px",
    marginBottom: "10px",
    borderRadius: "5px",
    border: "1px solid #ccc",
  },
  textarea: {
    width: "100%",
    padding: "10px",
    marginBottom: "10px",
    borderRadius: "5px",
    border: "1px solid #ccc",
    minHeight: "100px",
  },
  button: {
    padding: "12px",
    backgroundColor: "#003366",
    color: "white",
    border: "none",
    borderRadius: "5px",
    cursor: "pointer",
    marginTop: "20px",
    fontWeight: "bold",
    fontSize: "16px",
  },
  addButton: {
    padding: "10px",
    margin: "10px 0",
    backgroundColor: "#003366",
    color: "white",
    border: "none",
    borderRadius: "5px",
    cursor: "pointer",
  },
  stepTitle: {
    fontSize: "20px",
    marginBottom: "10px",
    marginTop: "20px",
    color: "#003366",
  },
  chapter: {
    border: "1px solid #ccc",
    borderRadius: "5px",
    padding: "15px",
    marginBottom: "15px",
    backgroundColor: "#f9f9f9",
  },
  lesson: {
    marginTop: "10px",
    padding: "10px",
    backgroundColor: "#e9ecef",
    borderRadius: "5px",
  },
  lessonButtonGroup: {
    marginTop: "10px",
  },
  inputGroup: {
    display: "block",  // ƒê·ªÉ c√°c th√†nh ph·∫ßn trong group n·∫±m tr√™n c√πng m·ªôt d√≤ng
    alignItems: "center",  // Canh ch·ªânh cho label v√† input n·∫±m c√πng m·ªôt chi·ªÅu cao
    marginBottom: "6px",  // Kho·∫£ng c√°ch gi·ªØa c√°c inputGroup (n·∫øu c·∫ßn)
  },
  label: {
    color: "#003366", // M√†u ch·ªØ xanh ƒë·∫≠m
    fontWeight: "bold",
    // c√°c style kh√°c n·∫øu c·∫ßn
  }
};

export default TeacherAddCourses;
